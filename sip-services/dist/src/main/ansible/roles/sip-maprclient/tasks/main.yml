- name: Create MapR group
  group:
    name: mapr
    gid: "{{ saw_mapr_group_id | default('500') }}"
    state: present
- name: Create MapR user
  user:
    name: mapr
    uid: "{{ saw_mapr_user_id | default('5000') }}"
    group: mapr
    state: present
- name: Install MapR client
  yum: name=mapr-client
# Workaround: The MapR logging configuration refers to a file that is
# not writable by the "mapr" user, so change the path to a writable
# location.
- name: Set MapR log file path to writable location
  replace:
    path: /opt/mapr/conf/log4j.properties
    regexp: '^log.file=log4.log$'
    replace: 'log.file=/tmp/log4.log'
# Workaround: The Transport Service uses "mapr classpath" which drops
# certain Hadoop libraries entries if the "which" command is missing.
# So install it as a workaround.
- name: Install which for MapR classpath command
  yum: name=which state=present
# ignore_errors for the below statement as it checking gracefully
# if mapr cluster configured in secured mode the set the ticket
# location
- name: Copy the mapr authentication ticket
  command : "install -C -o mapr -g mapr /opt/mapr/conf/mapruserticket /opt/mapr/conf/maprticket_5000"
  when: sip_secure
  ignore_errors: yes
- name: Setup mapr ticket Location
  lineinfile: dest=/home/mapr/.bashrc line='export MAPR_TICKETFILE_LOCATION=/opt/mapr/conf/maprticket_5000'
  when: sip_secure
  ignore_errors: yes

