- name: restart saw-transport
  # Stop service, to trigger restart by socket activation
  systemd: name=saw-transport state=stopped daemon_reload=true
  # Workaround: Occasionally deployments will fail with "Job for
  # saw-transport.service canceled".  The root cause is not known, but
  # retry as a workaround for now.
  register: result
  until: result is success
# Workaround: The Ansible systemd module fails with an "Could not find
# the requested service saw-transport-executor@*" error when working
# with wildcards, so work around this by enumerating instances for
# now.
#- name: restart saw-transport-executor
#  systemd: name=saw-transport-executor@* state=restarted daemon_reload=true
- name: restart saw-transport-executor-regular
  systemd: name=saw-transport-executor@regular-{{ item }} state=stopped daemon_reload=true
  with_sequence: count={{ saw_transport_executor_regular_count | default('1') }}
  # Workaround: Occasionally deployments will fail with "Job for
  # service canceled".  The root cause is not known, but retry as a
  # workaround for now.
  register: result
  until: result is success
- name: restart saw-transport-executor-fast
  systemd: name=saw-transport-executor@fast-{{ item }} state=stopped daemon_reload=true
  with_sequence: count={{ saw_transport_executor_fast_count | default('1') }}
  # Workaround: Occasionally deployments will fail with "Job for
  # service canceled".  The root cause is not known, but retry as a
  # workaround for now.
  register: result
  until: result is success
