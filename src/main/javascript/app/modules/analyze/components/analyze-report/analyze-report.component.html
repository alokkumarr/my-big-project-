<analyze-dialog control="$ctrl" class="analyze-report-dialog">
  <analyze-dialog-header>
    <div layout="row">
      <md-button class="ard_back-btn"
                 ng-click="$ctrl.$dialog.closeDialog()">
        <md-icon md-font-icon="icon-arrow-left"></md-icon>
      </md-button>

      <div class="ard_meta" flex>
        <div class="md-title">
          <strong ng-bind="$ctrl.data.title"></strong>
          <label>Draft</label>
        </div>
        <div class="md-description">
          <md-icon md-font-icon="icon-report"></md-icon>
          <span>Orders</span>
        </div>
      </div>

      <div class="ard_actions" flex>
        <md-button ng-click="$ctrl.openExportModal()">Export</md-button>
        <md-button ng-click="$ctrl.openSaveModal()">Save</md-button>
        <md-button class="btn-primary"
                   ng-click="$ctrl.openPublishModal()">Publish
        </md-button>
      </div>
    </div>
  </analyze-dialog-header>

  <analyze-dialog-content>
    <analyze-filter-sidenav></analyze-filter-sidenav>
    <div layout="column">
      <div class="ard_content" layout="column">
        <div layout="row" class="ard_sub-header">
          <span ng-if="$ctrl.states.sqlMode === $ctrl.DESIGNER_MODE">
            Choose fields to show in your report
          </span>

          <span ng-if="$ctrl.states.sqlMode === $ctrl.QUERY_MODE">
            SQL Query
          </span>

          <div>
            <md-button ng-class="{'m-active': $ctrl.states.sqlMode === $ctrl.DESIGNER_MODE}"
                       ng-click="$ctrl.setSqlMode($ctrl.DESIGNER_MODE)">
              <md-icon md-font-icon="icon-designer-mode"></md-icon>
              Designer
            </md-button>

            <md-button ng-class="{'m-active': $ctrl.states.sqlMode === $ctrl.QUERY_MODE}"
                       ng-click="$ctrl.setSqlMode($ctrl.QUERY_MODE)">
              <md-icon md-font-icon="icon-query-mode"></md-icon>
              Query
            </md-button>
          </div>
        </div>

        <div layout="row" class="ard_canvas">
          <div ng-show="$ctrl.states.sqlMode === $ctrl.DESIGNER_MODE">
            <js-plumb-canvas id="ard-canvas"></js-plumb-canvas>
          </div>

          <div class="ard_canvas-query"
               ng-show="$ctrl.states.sqlMode === $ctrl.QUERY_MODE">
            <textarea ng-model="$ctrl.data.query" readonly></textarea>
          </div>
        </div>
      </div>

      <div layout="row" class="ard_toolbar">
        <md-button class="ard_toolbar-expand"
                   ng-click="$ctrl.toggleDetailsPanel()">
          <md-icon md-font-icon="icon-expand"></md-icon>
        </md-button>

        <span class="ard_toolbar-text" flex>Report</span>

        <div class="ard_toolbar-actions" flex>
          <md-button ng-click="$ctrl.openDescriptionModal($event)">
            <md-icon md-font-icon="icon-description"></md-icon>
            Description
          </md-button>

          <md-button ng-click="$ctrl.openPreviewModal($event)"
                     ng-disabled="!$ctrl.columns.length">
            <md-icon md-font-icon="icon-full-screen"></md-icon>
            Preview
          </md-button>

          <md-button ng-click="$ctrl.openSortModal($event)">
            <md-icon md-font-icon="icon-sort"></md-icon>
            Sort
          </md-button>

          <md-button ng-if="$ctrl.showFiltersButton" ng-click="$ctrl.openFilterSidenav()">
            <md-icon md-font-icon="icon-filter"></md-icon>
            Filter
          </md-button>
        </div>
      </div>

      <div layout="column" class="ard_details-panel"
           ng-show="$ctrl.states.detailsExpanded">
        <div layout="column" class="ard_details-panel-empty"
             ng-show="!$ctrl.columns.length">
          <span>Choose fields above to preview your report.</span>
          <md-icon md-font-icon="icon-report"></md-icon>
        </div>

        <div layout="row" ng-if="$ctrl.filters.selected.length > 0">
          <div layout="column" style="padding: 6px 20px 10px 0">
            {{$ctrl.filters.selected.length}} Filters Applied
            <md-button class="btn-card" ng-click="$ctrl.onClearAllFilters()">Clear all</md-button>
          </div>
          <md-chips class="filter-tags" readonly="true"
                    ng-model="$ctrl.filters.selected"
                    md-removable="true"
                    md-on-remove="$ctrl.onFilterRemoved($chip)">
            <md-chip-template>
              <span>{{$chip}}</span>
            </md-chip-template>

            <button class="md-primary" md-chip-remove>
              <md-icon md-font-icon="icon-remove"></md-icon>
            </button>
          </md-chips>
        </div>

        <report-grid-container
          id="ard-grid-container"
          class="ard_details-grid"
          columns="$ctrl.columns"
          data="$ctrl.gridData"
          ng-show="$ctrl.columns.length">
        </report-grid-container>
      </div>
    </div>
  </analyze-dialog-content>
</analyze-dialog>
