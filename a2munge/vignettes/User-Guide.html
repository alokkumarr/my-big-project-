<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Haarstick" />

<meta name="date" content="2018-11-16" />

<title>a2munge User Guide</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">a2munge User Guide</h1>
<h4 class="author"><em>Haarstick</em></h4>
<h4 class="date"><em>2018-11-16</em></h4>



<div id="overview" class="section level2">
<h2>Overview</h2>
<p>a2munge is an R package to help create <em>Big Data</em> Advanced Analytic data pipelines. The package contains a suite of Spark<a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a> compatible data preparation, transformation and analytic functions (aka munging). Advanced Analytics data pipelines, or data pipelines to create statistical model training data often require complex data cleansing, transformation and preperation. The a2munge package is design to efficiently create such pipelines.</p>
<div id="features" class="section level3">
<h3>Features</h3>
<ul>
<li>Data transformation functions support Spark and in-memory R data set classes </li>
<li>Functions are compatible with dplyr<a href="#fn2" class="footnoteRef" id="fnref2"><sup>2</sup></a> and tidyr<a href="#fn3" class="footnoteRef" id="fnref3"><sup>3</sup></a> verbs</li>
<li>Individual functions can be combined to create flexible, complex data pipelines</li>
<li>Programmatic function interface support application and solution templates</li>
<li>Combines with a2modeler R package to allow Advanced Analytics application development to be done with a single programming language (vs traditional sql / statistical software split)</li>
<li>Statistical Anomaly Detection for time series data</li>
</ul>
</div>
<div id="design" class="section level3">
<h3>Design</h3>
<p>a2munge leverages the R S3<a href="#fn4" class="footnoteRef" id="fnref4"><sup>4</sup></a> Object Oriented system to create generic functions with R data.frame and Spark class methods. This design creates a similiar set of functions and arguments for the user that can be applied on local R data.frames, local Spark data objects, or even distributed Spark objects.</p>
<p>a2munge uses standard evaluation <a href="#fn5" class="footnoteRef" id="fnref5"><sup>5</sup></a> to evaluate function arguments. This allows for function arguments to be assigned programmatically which is beneficial for re-usable template and component development.</p>
<p>a2munge functions standarize the output naming convention and schema which creates consistency aiding in application development.</p>
<p>a2munge spark compatibility relies on the great sparklyr<a href="#fn6" class="footnoteRef" id="fnref6"><sup>6</sup></a> R package which enables a R API for working with Spark objets.</p>
</div>
</div>
<div id="functions" class="section level2">
<h2>Functions</h2>
<p>In the following sections each of the a2munge functions are explained with examples. In the chunk below an sample dataset is create in local R. A local Spark connection is created and the sample dataset is copied to the Spark environment.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># R packages</span>
<span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(lubridate)
<span class="kw">library</span>(sparklyr)

<span class="co"># Create Simulated Dataset:</span>
<span class="kw">set.seed</span>(<span class="dv">319</span>)
n &lt;-<span class="st"> </span><span class="dv">100</span>                           <span class="co"># Records per ID</span>
id_vars &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">101</span>, <span class="dv">200</span>, <span class="dt">by=</span><span class="dv">1</span>)     <span class="co"># Unique IDs</span>
dates &lt;-<span class="st"> </span><span class="kw">today</span>() <span class="op">-</span><span class="st"> </span><span class="kw">days</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">90</span>)      <span class="co"># Date Range</span>
cat1 &lt;-<span class="st"> </span>LETTERS[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>]               <span class="co"># Category Var 1</span>
cat2 &lt;-<span class="st"> </span>LETTERS[<span class="kw">c</span>(<span class="dv">22</span><span class="op">:</span><span class="dv">26</span>)]          <span class="co"># Category Var 2</span>

df &lt;-<span class="st"> </span><span class="kw">tibble</span>()
<span class="cf">for</span>(id <span class="cf">in</span> id_vars){
  d &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">id =</span> id,
              <span class="dt">date =</span> <span class="kw">as.character</span>(<span class="kw">sample</span>(dates, n, <span class="dt">replace =</span> T)),
              <span class="dt">cat1 =</span> <span class="kw">sample</span>(cat1, n, <span class="dt">replace =</span> T, <span class="dt">prob =</span> <span class="kw">c</span>(.<span class="dv">75</span>, .<span class="dv">25</span>)),
              <span class="dt">cat2 =</span> <span class="kw">sample</span>(cat2, n, <span class="dt">replace =</span> T, <span class="dt">prob =</span> <span class="kw">c</span>(.<span class="dv">4</span>, .<span class="dv">3</span>, .<span class="dv">2</span>, .<span class="dv">075</span>, .<span class="dv">025</span>)),
              <span class="dt">metric1 =</span> <span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, n, <span class="dt">replace =</span> T),
              <span class="dt">metric2 =</span> <span class="kw">rnorm</span>(n, <span class="dt">mean=</span><span class="dv">50</span>, <span class="dt">sd =</span> <span class="dv">5</span>))
  df &lt;-<span class="st"> </span><span class="kw">rbind</span>(df, d)
}


<span class="co"># Create Spark Connection</span>
sc &lt;-<span class="st"> </span><span class="kw">spark_connect</span>(<span class="dt">master =</span> <span class="st">&quot;local&quot;</span>)

<span class="co"># Copy Data to Spark</span>
sdf &lt;-<span class="st"> </span><span class="kw">copy_to</span>(sc, df, <span class="st">&quot;df&quot;</span>, <span class="dt">overwrite =</span> <span class="ot">TRUE</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># R Dataset</span>
df
<span class="co">#&gt; # A tibble: 10,000 x 6</span>
<span class="co">#&gt;       id date       cat1  cat2  metric1 metric2</span>
<span class="co">#&gt;    &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt; &lt;chr&gt;   &lt;int&gt;   &lt;dbl&gt;</span>
<span class="co">#&gt;  1   101 2018-09-04 A     V           4    52.2</span>
<span class="co">#&gt;  2   101 2018-08-18 A     X           2    46.3</span>
<span class="co">#&gt;  3   101 2018-10-01 A     W           5    54.4</span>
<span class="co">#&gt;  4   101 2018-09-30 B     V           5    45.9</span>
<span class="co">#&gt;  5   101 2018-10-31 A     V           3    55.4</span>
<span class="co">#&gt;  6   101 2018-09-13 A     Y           1    43.5</span>
<span class="co">#&gt;  7   101 2018-09-30 B     V           2    55.1</span>
<span class="co">#&gt;  8   101 2018-08-19 A     W           5    45.9</span>
<span class="co">#&gt;  9   101 2018-10-10 A     X           5    51.6</span>
<span class="co">#&gt; 10   101 2018-11-12 A     X           1    51.8</span>
<span class="co">#&gt; # ... with 9,990 more rows</span>

<span class="co"># Spark Dataset</span>
sdf
<span class="co">#&gt; # Source: spark&lt;df&gt; [?? x 6]</span>
<span class="co">#&gt;       id date       cat1  cat2  metric1 metric2</span>
<span class="co">#&gt;  * &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt; &lt;chr&gt;   &lt;int&gt;   &lt;dbl&gt;</span>
<span class="co">#&gt;  1   101 2018-09-04 A     V           4    52.2</span>
<span class="co">#&gt;  2   101 2018-08-18 A     X           2    46.3</span>
<span class="co">#&gt;  3   101 2018-10-01 A     W           5    54.4</span>
<span class="co">#&gt;  4   101 2018-09-30 B     V           5    45.9</span>
<span class="co">#&gt;  5   101 2018-10-31 A     V           3    55.4</span>
<span class="co">#&gt;  6   101 2018-09-13 A     Y           1    43.5</span>
<span class="co">#&gt;  7   101 2018-09-30 B     V           2    55.1</span>
<span class="co">#&gt;  8   101 2018-08-19 A     W           5    45.9</span>
<span class="co">#&gt;  9   101 2018-10-10 A     X           5    51.6</span>
<span class="co">#&gt; 10   101 2018-11-12 A     X           1    51.8</span>
<span class="co">#&gt; # ... with more rows</span></code></pre></div>
<div id="manipulaters" class="section level3">
<h3>Manipulaters</h3>
<div id="summariser" class="section level4">
<h4>Summariser</h4>
</div>
<div id="summariser-map" class="section level4">
<h4>Summariser Map</h4>
</div>
<div id="mutater" class="section level4">
<h4>Mutater</h4>
</div>
<div id="roller" class="section level4">
<h4>Roller</h4>
</div>
<div id="lagger" class="section level4">
<h4>Lagger</h4>
</div>
<div id="imputer" class="section level4">
<h4>Imputer</h4>
</div>
</div>
<div id="reshapers" class="section level3">
<h3>Reshapers</h3>
<div id="pivoter" class="section level4">
<h4>Pivoter</h4>
</div>
<div id="melter" class="section level4">
<h4>Melter</h4>
</div>
<div id="expander" class="section level4">
<h4>Expander</h4>
</div>
</div>
<div id="time-series" class="section level3">
<h3>Time Series</h3>
<div id="indexer" class="section level4">
<h4>Indexer</h4>
</div>
<div id="date-parter" class="section level4">
<h4>Date Parter</h4>
</div>
<div id="collapser" class="section level4">
<h4>Collapser</h4>
</div>
<div id="formatter" class="section level4">
<h4>Formatter</h4>
</div>
<div id="converter" class="section level4">
<h4>Converter</h4>
</div>
</div>
<div id="others" class="section level3">
<h3>Others</h3>
<div id="reader" class="section level4">
<h4>Reader</h4>
</div>
<div id="writer" class="section level4">
<h4>Writer</h4>
</div>
<div id="sampler" class="section level4">
<h4>Sampler</h4>
</div>
<div id="collecter" class="section level4">
<h4>Collecter</h4>
</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>Spark Data Processing Engine<a href="https://spark.apache.org/">via</a><a href="#fnref1">↩</a></p></li>
<li id="fn2"><p>dplyr R package <a href="https://dplyr.tidyverse.org/">via</a><a href="#fnref2">↩</a></p></li>
<li id="fn3"><p>tidyr R package <a href="https://tidyr.tidyverse.org/">via</a><a href="#fnref3">↩</a></p></li>
<li id="fn4"><p>R S3 OO <a href="http://adv-r.had.co.nz/S3.html">via</a><a href="#fnref4">↩</a></p></li>
<li id="fn5"><p>dplyr standard evaluation intro <a href="https://dplyr.tidyverse.org/articles/programming.html">via</a><a href="#fnref5">↩</a></p></li>
<li id="fn6"><p>sparklyr R package <a href="https://spark.rstudio.com/">via</a><a href="#fnref6">↩</a></p></li>
</ol>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
