<header class="dialog__header">
  <strong i18n>Publish Analysis</strong>
</header>
<div class="dialog__content"
     fxLayout="column">

    <div class="ars-content" layout-padding>
      <div class="form-container" layout="column">
        <label class="field-label" i18n>Publish to</label>
        <div style="max-width: 200px;">
          <mat-select placeholder="Select a Category"
                      (selectionChange)="onCategorySelected($event.value)"
                      [value]="data.analysis.categoryId">
            <mat-optgroup *ngFor="let category of categories" [label]="category.name">
              <mat-option *ngFor="let subCategory of category.children"
                          [value]="subCategory.id"
              >{{ subCategory.name }}</mat-option>
            </mat-optgroup>
          </mat-select>
        </div>
      </div>

      <div class="form-container" layout="column">
        <mat-checkbox [(ngModel)]="hasSchedule">
          <span i18n>Scheduled</span>
        </mat-checkbox>
      </div>

      <div *ngIf="hasSchedule" class="schedule-container" fxLayout="column">
        <cron-job-schedular *ngIf="hasSchedule" [crondetails]="crondetails" (onCronChanged)="onCronChanged($event)"></cron-job-schedular>

        <div class="form-container" fxLayout="column">
          <label i18n>Publish to Email</label>
          <mat-form-field flex="20">
            <mat-chip-list #chipList>
              <mat-chip *ngFor="let email of emails; trackBy: index; let i = index" (removed)="removeEmail(i)">
                <div ng-if="validateThisEmail(email)" class="errorMsg">?</div>
                {{email}}
                <mat-icon matChipRemove fontIcon="icon-close"></mat-icon>
              </mat-chip>
              <input placeholder="Emails separate by ';'"
                     [matChipInputFor]="chipList"
                     [matChipInputSeparatorKeyCodes]="separatorKeys"
                     [matChipInputAddOnBlur]="true"
                     (matChipInputTokenEnd)="addEmail($event)" />
            </mat-chip-list>
          </mat-form-field>
        </div>

        <div *ngIf="data.analysis.type !== 'chart'" class="form-container" fxLayout="column">

          <label i18n>Publish to FTP</label>
          <div class="publish-form" fxLayout="row" fxLayoutAlign="start center">
            <mat-select [value]="ftp"
                        (selectionChange)="onLocationSelected($event.value)"
                        placeholder="Select FTP Location"
                        md-container-class="ftp-select"
                        class="ftp-select-box"
                        multiple
            >
              <mat-option *ngFor="let location of locations" [value]="location">{{ location }}</mat-option>
            </mat-select>
            <span class="clear" (click)="ftp = [];">Clear</span>
          </div>
        </div>
        <span *ngIf="emailValidateFlag" class="errorTextMsg" i18n>Invalid Email-Id Found: Please provide valid Email-Id's in list</span>
        <span *ngIf="errorFlagMsg" class="errorTextMsg" i18n>Please enter valid Email ids or Select option for Publish</span>
        <span *ngIf="cronValidateField" class="errorTextMsg" i18n>Please Select a valid Schedule</span>
      </div>

    </div>

</div>
<div class="dialog__actions">
  <div fxLayout="row"
       fxLayoutAlign="start center">
    <button (click)="publish()"
            mat-raised-button color="primary" i18n>
      Publish
    </button>
    <button mat-button i18n (click)="close()">Cancel</button>
  </div>
</div>

