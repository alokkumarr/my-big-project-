<dx-data-grid class="report-dx-grid"
    #dataGrid
    (onContextMenuPreparing)="onContextMenuPreparing($event)"
    (onContentReady)="onContentReady($event)"
    [customizeColumns]="customizeColumns"
    [columnAutoWidth]="columnAutoWidth"
    [columnMinWidth]="columnMinWidth"
    [columnResizingMode]="columnResizingMode"
    [allowColumnReordering]="allowColumnReordering"
    [allowColumnResizing]="allowColumnResizing"
    [showColumnHeaders]="showColumnHeaders"
    [showColumnLines]="showColumnLines"
    [showRowLines]="showRowLines"
    [showBorders]="showBorders"
    [rowAlternationEnabled]="rowAlternationEnabled"
    [hoverStateEnabled]="hoverStateEnabled"
    [wordWrapEnabled]="wordWrapEnabled"
    [scrolling]="scrolling"
    [sorting]="sorting"
    [height]="gridHeight"
    [width]="gridWidth"
    [dataSource]="data"
    [columns]="columns"
    [columnChooser]="columnChooser"
    [remoteOperations]="remoteOperations"
    [loadPanel]="loadPanel"
    [pager]="pager"
    [paging]="paging">

    <div class="headerCellTemplate" *dxTemplate="let cell of 'headerCellTemplate'">
        <div class="cell-aggregate-icon">
            <mat-icon [style.width.px]="40" [fontIcon]="cell.column.payload.aggregate ? AGGREGATE_TYPES_OBJ[cell.column.payload.aggregate].icon : ''"></mat-icon>
        </div>
        <div class="cell-caption">
            {{cell.column.caption}}
        </div>
        <div *ngIf="isEditable" class="cell-context-menu">
            <!-- <mat-icon (click)="onHeaderClick(cell)" fontIcon="icon-more"></mat-icon> -->

            <button fontIcon="icon-more" mat-button [matMenuTriggerFor]="menu"></button>
            <mat-icon [matMenuTriggerFor]="menu" fontIcon="icon-more"></mat-icon>

            <mat-menu #menu="matMenu">
              <button *ngIf="analysis.type=='esReport'" mat-menu-item [matMenuTriggerFor]="aggregations">
              <mat-icon fontIcon="icon-more"></mat-icon>  
              Aggregation</button>
              <button (click)="renameColumn(cell.column)" mat-menu-item><mat-icon fontIcon="icon-edit"></mat-icon>  Rename</button>
              <button (click)="removeColumn(cell.column)" mat-menu-item><mat-icon fontIcon="icon-eye-disabled"></mat-icon>  Remove {{cell.column.payload.displayName}}</button>
              <button (click)="formatColumn(cell.column)" mat-menu-item><mat-icon fontIcon="icon-filter"></mat-icon>  Format Data</button>
            </mat-menu>

            <mat-menu #aggregations="matMenu">
              <button *ngIf="cell.column.payload.type === 'double' || cell.column.payload.type === 'integer' || cell.column.payload.type === 'long'" (click)="aggregateColumn(cell.column.payload, 'sum')" mat-menu-item><mat-icon style="margin-right: 25px;" fontIcon="icon-Sum"></mat-icon>Total</button>
              <button *ngIf="cell.column.payload.type === 'double' || cell.column.payload.type === 'integer' || cell.column.payload.type === 'long'" (click)="aggregateColumn(cell.column.payload, 'avg')" mat-menu-item><mat-icon style="margin-right: 25px;" fontIcon="icon-AVG"></mat-icon>Average</button>
              <button *ngIf="cell.column.payload.type === 'double' || cell.column.payload.type === 'integer' || cell.column.payload.type === 'long'" (click)="aggregateColumn(cell.column.payload, 'min')" mat-menu-item><mat-icon style="margin-right: 25px;" fontIcon="icon-MIN"></mat-icon>Minimum</button>
              <button *ngIf="cell.column.payload.type === 'double' || cell.column.payload.type === 'integer' || cell.column.payload.type === 'long'" (click)="aggregateColumn(cell.column.payload, 'max')" mat-menu-item><mat-icon style="margin-right: 25px;" fontIcon="icon-MAX"></mat-icon>Maximum</button>
              <button (click)="aggregateColumn(cell.column.payload, 'count')" mat-menu-item><mat-icon style="margin-right: 25px;" fontIcon="icon-Count"></mat-icon>Count</button>
              <button *ngIf="cell.column.payload.type === 'double' || cell.column.payload.type === 'integer' || cell.column.payload.type === 'long'" (click)="aggregateColumn(cell.column.payload, 'percentage')" mat-menu-item><mat-icon style="margin-right: 25px;" fontIcon="icon-Percentage"></mat-icon>Percentage</button>
              <button (click)="aggregateColumn(cell.column.payload, 'clear')" mat-menu-item>Reset To Default</button>
            </mat-menu>            
        </div>    
    </div>
</dx-data-grid>
