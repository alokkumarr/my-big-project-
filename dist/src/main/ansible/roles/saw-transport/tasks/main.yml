- name: Install SAW Transport Service package
  yum: name="{{ item }}" state=present
  with_fileglob: ["../rpms/saw-transport-*.rpm"]
  notify:
    - restart saw-transport
- name: Install SAW Transport Service configuration file
  template: src=application.conf dest=/opt/saw/service/conf
  notify:
    - restart saw-transport
- name: Enable SAW Transport Service
  systemd: name=saw-transport enabled=true daemon_reload=true
- name: Create SAW Transport Service metadata store directory
  # Workaround: If "sudo" does not exist, it indicates deployment is
  # running inside the soon to be removed saw-services repository
  # which does not have MapR-FS configured.  So skip creating the
  # directory in that case.
  #become: true
  #become_user: mapr
  #shell: hadoop fs -mkdir -p /main/metadata
  shell: "command -v sudo && sudo -u mapr hadoop fs -mkdir -p /main/metadata || :"
