#!/bin/sh
#
# Configure MapR container for SIP
#
# Do configuring in service, instead of Dockerfile, because the MapR
# services apparently need to be running while doing the
# configuration.
#
set -eu

marker=/etc/sip-mapr-configure-marker

host=sip-mapr
disk=/opt/mapr/disk

if [ ! -e $marker ]; then
    echo "Configuring MapR for SIP"
    # Note: Ensure the disk size is large enough (for example 5G is
    # too little) to ensure that MapR-FS can start up
    fallocate -l 20G $disk
    /opt/mapr/server/configure.sh -C $host -Z $host -D $disk -N sip
    touch $marker
fi
